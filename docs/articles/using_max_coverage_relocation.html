<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using max_coverage_relocation • maxcovr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">maxcovr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/njtierney/maxcovr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Using max_coverage_relocation</h1>
                        <h4 class="author">Nicholas Tierney</h4>
            
            <h4 class="date">2017-02-05</h4>
          </div>

    
    
<div class="contents">
<p>This vignette provides a guide to using maxcovr to solve the maximum covering location problem, assuming that you can relocate facilities.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">library</span>(maxcovr)</code></pre></div>
<p>The normal method, <code>max_coverage</code> is limited in that it assumes that you cannot move existing facilities. <code>max_coverage_relocation</code> assumes that you can move already existing facilities, but that there is some cost of removal, and a cost of installation.</p>
<p>To illustrate the benefits of relocation, we are first going to consider an example where the existing facilities provide no coverage to users. We identify facility locations that are really far away.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">york_selected_worst_id &lt;-<span class="st"> </span>york_crime %&gt;%<span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="../reference/nearest.html">nearest</a></span>(york) %&gt;%
<span class="st">    </span><span class="kw">arrange</span>(-distance) %&gt;%
<span class="st">    </span><span class="kw">slice</span>(<span class="dv">1</span>:<span class="dv">20</span>) %&gt;%
<span class="st">    </span><span class="kw">select</span>(desig_id) %&gt;%
<span class="st">    </span><span class="kw">distinct</span>(desig_id)
    
    
york_worst &lt;-<span class="st"> </span>york_selected_worst_id %&gt;%<span class="st"> </span>
<span class="st">    </span><span class="kw">left_join</span>(york,
              <span class="dt">by =</span> <span class="st">"desig_id"</span>)</code></pre></div>
<p>Then we identify some really ideal locations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">york_not_selected_worst &lt;-<span class="st"> </span>york %&gt;%
<span class="st">    </span><span class="kw">anti_join</span>(york_worst,
              <span class="dt">by =</span> <span class="st">"desig_id"</span>)

york_best &lt;-<span class="st"> </span>
<span class="st"> </span>york_crime %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/nearest.html">nearest</a></span>(york_not_selected_worst) %&gt;%
<span class="st">    </span><span class="kw">arrange</span>(distance) %&gt;%
<span class="st">    </span><span class="kw">slice</span>(<span class="dv">1</span>:<span class="dv">100</span>) %&gt;%
<span class="st">    </span><span class="kw">select</span>(desig_id) %&gt;%
<span class="st">    </span><span class="kw">distinct</span>(desig_id) %&gt;%
<span class="st">    </span><span class="kw">left_join</span>(york,
              <span class="dt">by =</span> <span class="st">"desig_id"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">york_best</code></pre></div>
<pre><code>## # A tibble: 101 × 7
##    desig_id      long      lat object_id pref_ref
##       &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;int&gt;    &lt;int&gt;
## 1    DYO788 -1.087865 53.95718      3362   463995
## 2    DYO857 -1.079543 53.96484      5549   463864
## 3    DYO857 -1.079543 53.96484      4212   463864
## 4   DYO1212 -1.084407 53.95989      5843   463237
## 5   DYO1212 -1.084407 53.95989      4506   463237
## 6    DYO862 -1.082647 53.95747      5554   463874
## 7    DYO862 -1.082647 53.95747      4217   463874
## 8   DYO1146 -1.078714 53.95886      5793   463399
## 9   DYO1146 -1.078714 53.95886      4456   463399
## 10  DYO1078 -1.086914 53.95748      5730   463443
## # ... with 91 more rows, and 2 more variables: name &lt;chr&gt;, grade &lt;chr&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">york_worst</code></pre></div>
<pre><code>## # A tibble: 21 × 7
##    desig_id       long      lat object_id pref_ref
##       &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt;     &lt;int&gt;    &lt;int&gt;
## 1     DYO91 -0.9795694 54.01890      3545   328688
## 2     DYO91 -0.9795694 54.01890      4882   328688
## 3    DYO222 -1.2028583 53.97360      3720   331644
## 4    DYO222 -1.2028583 53.97360      5057   331644
## 5   DYO1477 -0.9832742 54.01594      6043   328687
## 6   DYO1477 -0.9832742 54.01594      4707   328687
## 7    DYO138 -1.2051517 53.97325      3591   331645
## 8    DYO138 -1.2051517 53.97325      4928   331645
## 9    DYO137 -1.1930094 53.97360      3590   331701
## 10   DYO137 -1.1930094 53.97360      4927   331701
## # ... with 11 more rows, and 2 more variables: name &lt;chr&gt;, grade &lt;chr&gt;</code></pre>
<p>So these are <em>worst</em> placements and ideally they should all get removed.</p>
<p>Here we tell <code>max_coverage_relocation</code> that the existing facilities are <code>york_worst</code>, the proposed facilities are <code>york_best</code>, the users we want to cover are given in <code>york_crime</code>, and the distance cutoff for coverage is 100m. We then provide the cost of installing a location, the cost of removing, and the total cost available.</p>
<p>In <code>max_coverage</code> we would instead state <code>n_added</code> = 1 - as this is effectively saying the same thing as below. There is only enough total resources to install one facility.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(
mc_relocate_worst &lt;-<span class="st">  </span><span class="kw"><a href="../reference/max_coverage_relocation.html">max_coverage_relocation</a></span>(<span class="dt">existing_facility =</span> york_worst,
                                              <span class="dt">proposed_facility =</span> york_best,
                                              <span class="dt">user =</span> york_crime,
                                              <span class="dt">distance_cutoff =</span> <span class="dv">100</span>,
                                              <span class="dt">cost_install =</span> <span class="dv">10</span>,
                                              <span class="dt">cost_removal =</span> <span class="dv">1</span>,
                                              <span class="dt">cost_total =</span> <span class="dv">10</span>)
)</code></pre></div>
<pre><code>##    user  system elapsed 
##   0.565   0.093   0.701</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mc_relocate_worst</code></pre></div>
<pre><code>## 
## ----------------------------------------- 
## Model Fit: maxcovr relocation model 
## ----------------------------------------- 
## model_used:        max_coverage_relocation 
## existing_facility: york_worst 
## proposed_facility: york_best 
## user:              york_crime 
## distance_cutoff:   100 
## cost_install:      10 
## cost_removal:     1 
## cost_total:        10 
## solver:            gurobi 
## -----------------------------------------</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(mc_relocate_worst)</code></pre></div>
<pre><code>## 
## --------------------------------------- 
## Model Fit: maxcovr relocation model 
## --------------------------------------- 
## Distance Cutoff: 100m 
## Facilities: 
##     Added:       10 
##     Removed:     10 
## Coverage (Previous): 
##     # Users:     260   (0) 
##     Proportion:  0.1433 (0) 
## Distance (m) to Facility (Previous): 
##        Avg:      1720 (5674) 
##        SD:       1542 (1040) 
## Costs: 
##     Total:       10 
##     Install:     10 
##     Removal:  1 
## ---------------------------------------</code></pre>
<p>You can then start to toy with the different pricings if you like.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(
mc_relocate_worst_eq &lt;-<span class="st">  </span><span class="kw"><a href="../reference/max_coverage_relocation.html">max_coverage_relocation</a></span>(<span class="dt">existing_facility =</span> york_worst,
                                              <span class="dt">proposed_facility =</span> york_best,
                                              <span class="dt">user =</span> york_crime,
                                              <span class="dt">distance_cutoff =</span> <span class="dv">100</span>,
                                              <span class="dt">cost_install =</span> <span class="dv">10</span>,
                                              <span class="dt">cost_removal =</span> <span class="dv">100</span>,
                                              <span class="dt">cost_total =</span> <span class="dv">10</span>)
)</code></pre></div>
<pre><code>##    user  system elapsed 
##   0.550   0.041   0.599</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mc_relocate_worst_eq</code></pre></div>
<pre><code>## 
## ----------------------------------------- 
## Model Fit: maxcovr relocation model 
## ----------------------------------------- 
## model_used:        max_coverage_relocation 
## existing_facility: york_worst 
## proposed_facility: york_best 
## user:              york_crime 
## distance_cutoff:   100 
## cost_install:      10 
## cost_removal:     100 
## cost_total:        10 
## solver:            gurobi 
## -----------------------------------------</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(mc_relocate_worst_eq)</code></pre></div>
<pre><code>## 
## --------------------------------------- 
## Model Fit: maxcovr relocation model 
## --------------------------------------- 
## Distance Cutoff: 100m 
## Facilities: 
##     Added:       1 
##     Removed:     0 
## Coverage (Previous): 
##     # Users:     44   (0) 
##     Proportion:  0.0243 (0) 
## Distance (m) to Facility (Previous): 
##        Avg:      2071 (5674) 
##        SD:       1521 (1040) 
## Costs: 
##     Total:       10 
##     Install:     10 
##     Removal:  100 
## ---------------------------------------</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Nicholas Tierney.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
